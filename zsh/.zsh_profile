#!/bin/bash
qtool(){
  if [ "$1" = "ip" ];then
    ifconfig | grep -Eo 'inet (addr:)?([0-9]*\.){3}[0-9]*' | grep -Eo '([0-9]*\.){3}[0-9]*' | grep -v '127.0.0.1' | grep -Ev '172.*.0.1'
  elif [ "$1" = "hs" ];then
	shift
	hserver $@
  elif [ "$1" = "get" ];then
    if [ "$2" = "ssr-win" ];then
      wget https://www.cordcloud.biz/ssr-download/ssr-win.7z
	  7z x ssr-win.7z -ossr
	elif [ "$2" = "-h" ];then
	  echo "qtool get [ssr-win]"
	fi
  else
    echo "Usage:"
    echo "  qtool [ip|ps]"
  fi
}
hserver(){
	port=${1-8080}
	ip=`qtool ip`
	python -m http.server $port --bind ${ip}
}
caps()
{
	cmd=${1:-'ls'}
	machines=${2:-'l0 l1 l4 l5'}
	pssh -i -H "$machines" "cd ~/caps3d && $cmd"
}

capsup()
{
	m=${1:-'l0'}
	o=${2:-'origin'}
	b=${3:-'dev'}
	caps "git push ${o} ${b}" $m && caps "git pull ${o} ${b}"
}

qdot(){
	~/.Qdotfiles/scripts/qdot "$@"
}
common_aliases () {
    alias ei="nvim ~/.Qdotfiles/scripts/init.sh"
	alias q="qdot"
    alias fm="ranger"
    alias sb="source ~/.zshrc"
    alias eb="nvim ~/.zshrc"
    alias cz="cd ~/.Qdotfiles/zsh/"
    alias cq="cd ~/.Qdotfiles/"
	alias cr="cd ~/.config/ranger/"
    alias unproxy='http_proxy="" https_proxy=""'
}
mac_aliases () {
    alias chrome="/Applications/Google\ Chrome.app/Contents/MacOS/Google\ Chrome"
    alias meshlab="/Applications/meshlab.app/Contents/MacOS/meshlab"
    alias meshlabserver="/Applications/meshlab.app/Contents/MacOS/meshlabserver"
}
linux_aliases () {
    alias hello="world"
}

common_aliases

# 系统特有的环境变量
if test "$(uname)" = "Darwin"
then
	mac_aliases

elif test "$(expr substr $(uname -s) 1 5)" = "Linux"
then
	linux_aliases

	#CUDA
	if [ -d "/usr/local/cuda-11.1/bin" ];then
		export PATH=/usr/local/cuda-11.1/bin${PATH:+:${PATH}}
		export LD_LIBRARY_PATH=/usr/local/cuda-11.1/lib64${LD_LIBRARY_PATH:+:${LD_LIBRARY_PATH}}
	fi
	#homebrew
	if [ -d /home/linuxbrew/.linuxbrew/ ];then
		eval $(/home/linuxbrew/.linuxbrew/bin/brew shellenv)
	fi
fi
